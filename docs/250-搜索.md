# æœç´¢

---

æƒ³è¦åœ¨ Elasticsearch ä¸­æœç´¢æ•°æ®ï¼Œéœ€è¦æŠŠæ•°æ®åœ¨ Elasticsearch ä¸­å†å­˜ä¸€ä»½

![](https://gitee.com/veal98/images/raw/master/img/20210129102538.png)

ä¸€ä¸ªç´¢å¼•å¯¹åº”ä¸€ä¸ªæ•°æ®åº“ï¼ˆ7.0 ä¸­ç´¢å¼•å¯¹åº”è¡¨ï¼‰ï¼Œä¸€ä¸ªç±»å‹å¯¹åº”ä¸€å¼ è¡¨ï¼ˆ7.0 å·²åºŸå¼ƒè¯¥å±æ€§ï¼‰ï¼Œä¸€ä¸ªæ–‡æ¡£å¯¹åº”è¡¨ä¸­çš„ä¸€è¡Œï¼Œä¸€ä¸ªå­—æ®µå¯¹åº”è¡¨ä¸­çš„ä¸€åˆ—

## ElasticSearch ä¸‹è½½å®‰è£…

æ³¨æ„ï¼Œä¸‹è½½ ElasticSearch ç‰ˆæœ¬ä¸€å®šè¦ä¸ä½ çš„ SpringBoot ç‰ˆæœ¬å†…éƒ¨è§„å®šçš„ä¸€è‡´ï¼Œæˆ‘çš„æ˜¯ SpringBoot 2.1.5

![](https://gitee.com/veal98/images/raw/master/img/20210129110801.png)

[Elasticsearch 6.4.3 ä¸‹è½½åœ°å€](https://www.elastic.co/cn/downloads/past-releases/elasticsearch-6-4-3)

è§£å‹å®Œæ¯•åï¼Œéœ€è¦é…ç½®ä¸€ä¸‹ï¼šconfig/elasticsearch.yml

<img src="https://gitee.com/veal98/images/raw/master/img/20210129111542.png" style="zoom:50%;" />

é…åˆ°ç¯å¢ƒå˜é‡ä¸­å»ï¼š

<img src="https://gitee.com/veal98/images/raw/master/img/20210129112143.png" style="zoom:50%;" />

è¿˜éœ€è¦å®‰è£…ä¸€ä¸ª**ä¸­æ–‡åˆ†è¯æ’ä»¶**ï¼ˆElasticsearch è‡ªå¸¦ä¸€ä¸ªè‹±æ–‡åˆ†è¯æ’ä»¶ï¼‰[elasticsearch-analysis-ik 6.4.3 ä¸‹è½½åœ°å€](https://github.com/medcl/elasticsearch-analysis-ik/releases/tag/v6.4.3)

æ³¨æ„ï¼šå¿…é¡»è§£å‹åˆ°ä½ çš„ elasticsearch å®‰è£…ç›®å½•çš„ plugins/ik æ–‡ä»¶å¤¹ä¸‹ï¼ˆD:\elasticsearch-6.4.3\plugins\ikï¼‰



å¯åŠ¨ elasticsearch

<img src="https://gitee.com/veal98/images/raw/master/img/20210129113947.png" style="zoom:50%;" />

å¸¸ç”¨å‘½ä»¤ï¼š

```shell
curl -X PUT "localhost:9200/test" åˆ›å»ºç´¢å¼•
	
curl -X GET "localhost:9200/_cat/indices?v" æŸ¥çœ‹ç´¢å¼•

curl -X DELETE "localhost:9200/test" åˆ é™¤ç´¢å¼•
```

![](https://gitee.com/veal98/images/raw/master/img/20210129115255.png)

å¯ä»¥ä½¿ç”¨ Postman ç®€åŒ–å‘½ä»¤è¡Œçš„æ“ä½œï¼Œæ¯”å¦‚åˆ›å»ºç´¢å¼•ï¼š

![](https://gitee.com/veal98/images/raw/master/img/20210129120150.png)

å¢åŠ ä¸€æ¡æ•°æ®ï¼š

![](https://gitee.com/veal98/images/raw/master/img/20210129121005.png)

æŸ¥è¯¢ï¼š

![](https://gitee.com/veal98/images/raw/master/img/20210129121131.png)

åˆ é™¤ï¼š

![](https://gitee.com/veal98/images/raw/master/img/20210129121139.png)

æœç´¢ï¼šæœç´¢ title ä¸­åŒ…å«â€œäº’è”ç½‘â€çš„å†…å®¹

![](https://gitee.com/veal98/images/raw/master/img/20210129121603.png)

å¤æ‚æœç´¢ï¼šæœç´¢ title æˆ– content ä¸­åŒ…å« â€œäº’è”ç½‘â€ çš„å†…å®¹

![](https://gitee.com/veal98/images/raw/master/img/20210129121919.png)

## Spring Boot æ•´åˆ Elasticsearch

### å¼•å…¥ä¾èµ–

```xml
<!--Elasticsearch-->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-elasticsearch</artifactId>
</dependency>
```

### é…ç½® Elasticsearch

- cluster-name
- cluster-nodes

```properties
# Elasticsearch
# è¯¥å­—æ®µè§ Elasticsearch å®‰è£…åŒ…ä¸­çš„ elasticsearch.ymlï¼Œå¯è‡ªè¡Œä¿®æ”¹
spring.data.elasticsearch.cluster-name = community
spring.data.elasticsearch.cluster-nodes = 127.0.0.1:9300
```

### è§£å†³ Elasticsearch å’Œ Redis åº•å±‚çš„ Netty å¯åŠ¨å†²çªé—®é¢˜

```java
@SpringBootApplication
public class CommunityApplication {

    /**
     * è§£å†³ Elasticsearch å’Œ Redis åº•å±‚çš„ Netty å¯åŠ¨å†²çªé—®é¢˜
     */
    @PostConstruct
    public void init() {
        System.setProperty("es.set.netty.runtime.available.processors", "false");
    }

    public static void main(String[] args) {
        SpringApplication.run(CommunityApplication.class, args);
    }

}
```

### Spring Data Elasticsearch

- ElasticsearchTemplate
- ElasticsearchRepositoryï¼ˆæ¨èï¼‰

é¦–å…ˆï¼Œå°†å®ä½“ç±»å’Œ Elasticsearch ä¹‹é—´å»ºç«‹è”ç³»ï¼š

```java
@Document(indexName = "discusspost", type = "_doc", shards = 6, replicas = 3)
public class DiscussPost {
```

type ç±»å‹åœ¨ elasticsearch 7 ç‰ˆæœ¬ä¸­å·²å®Œå…¨æŠ›å¼ƒï¼Œ6 ä¹Ÿä¸å¤ªå»ºè®®ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å›ºå®šä¸º _docï¼Œä¸ç”¨å»ç®¡å®ƒ

```java
@Document(indexName = "discusspost", type = "_doc", shards = 6, replicas = 3)
public class DiscussPost {

    @Id
    private int id;

    @Field(type = FieldType.Integer)
    private int userId;

    @Field(type = FieldType.Text, analyzer = "ik_max_word", searchAnalyzer = "ik_smart")
    private String title;

    @Field(type = FieldType.Text, analyzer = "ik_max_word", searchAnalyzer = "ik_smart")
    private String content;

    @Field(type = FieldType.Integer)
    private int type;

    @Field(type = FieldType.Integer)
    private int status;

    @Field(type = FieldType.Date)
    private Date createTime;

    @Field(type = FieldType.Integer)
    private int commentCount;

    @Field(type = FieldType.Double)
    private double score;
```

æµ‹è¯•å¢åˆ æ”¹æŸ¥ï¼š

```java
@RunWith(SpringRunner.class)
@ContextConfiguration(classes = CommunityApplication.class)
@SpringBootTest
public class ElasticsearchTests {

    @Autowired
    private DiscussPostMapper discussPostMapper;

    @Autowired
    private DiscussPostRepository discussPostRepository;

    @Autowired
    private ElasticsearchTemplate elasticsearchTemplate;

    /**
     * æµ‹è¯•æ’å…¥æ•°æ®
     */
    @Test
    public void testInsert() {
        discussPostRepository.save(discussPostMapper.selectDiscussPostById(241));
        discussPostRepository.save(discussPostMapper.selectDiscussPostById(242));
        discussPostRepository.save(discussPostMapper.selectDiscussPostById(243));
    }

    /**
     * æµ‹è¯•æ‰¹é‡æ’å…¥æ•°æ®
     */
    @Test
    public void testInsetList() {
        discussPostRepository.saveAll(discussPostMapper.selectDiscussPosts(101, 0, 100));
        discussPostRepository.saveAll(discussPostMapper.selectDiscussPosts(102, 0, 100));
        discussPostRepository.saveAll(discussPostMapper.selectDiscussPosts(103, 0, 100));
        discussPostRepository.saveAll(discussPostMapper.selectDiscussPosts(111, 0, 100));
        discussPostRepository.saveAll(discussPostMapper.selectDiscussPosts(112, 0, 100));
        discussPostRepository.saveAll(discussPostMapper.selectDiscussPosts(131, 0, 100));
        discussPostRepository.saveAll(discussPostMapper.selectDiscussPosts(132, 0, 100));
        discussPostRepository.saveAll(discussPostMapper.selectDiscussPosts(133, 0, 100));
        discussPostRepository.saveAll(discussPostMapper.selectDiscussPosts(134, 0, 100));
    }

    /**
     * æµ‹è¯•ä¿®æ”¹æ•°æ®
     */
    @Test
    public void testUpdate() {
        DiscussPost discussPost = discussPostMapper.selectDiscussPostById(231);
        discussPost.setContent("Great Elasticsearch");
        discussPostRepository.save(discussPost);
    }

    /**
     * æµ‹è¯•åˆ é™¤æ•°æ®ï¼ˆæ³¨æ„æ•°æ®åº“ä¸­çš„æ•°æ®å¹¶æœªè¢«åˆ é™¤ï¼‰
     */
    @Test
    public void testDelete() {
        discussPostRepository.deleteById(231);
        // discussPostRepository.deleteAll();
    }

    /**
     * æµ‹è¯•ä½¿ç”¨ ElasticsearchRepository è¿›è¡Œæœç´¢
     */
    @Test
    public void testSearchByRepository() {
        SearchQuery searchQuery = new NativeSearchQueryBuilder()
                .withQuery(QueryBuilders.multiMatchQuery("äº’è”ç½‘å¯’å†¬", "title", "content"))
                .withSort(SortBuilders.fieldSort("type").order(SortOrder.DESC))
                .withSort(SortBuilders.fieldSort("score").order(SortOrder.DESC))
                .withSort(SortBuilders.fieldSort("createTime").order(SortOrder.DESC))
                .withPageable(PageRequest.of(0, 10))
                .withHighlightFields(
                        new HighlightBuilder.Field("title").preTags("<em>").postTags("</em>"),
                        new HighlightBuilder.Field("content").preTags("<em>").postTags("</em>")
                ).build();

        // elasticsearchTemplate.queryForPage(searchQuery, class, SearchResultMapper);
        // åº•å±‚è·å–åˆ°äº†é«˜äº®æ˜¾ç¤ºçš„å€¼ï¼Œä½†æ˜¯æ²¡æœ‰åšå¤„ç†ï¼ˆæ‰€ä»¥æƒ³è¦æ›´åŠ å®Œå–„çš„è¯éœ€è¦ä½¿ç”¨ ElasticsearchTemplate)

        Page<DiscussPost> page = discussPostRepository.search(searchQuery);

        System.out.println(page.getTotalElements());
        System.out.println(page.getTotalPages());
        System.out.println(page.getNumber());
        System.out.println(page.getSize());
        for (DiscussPost post : page) {
            System.out.println(post);
        }
    }

    /**
     * æµ‹è¯•ä½¿ç”¨ ElasticsearchTemplate è¿›è¡Œæœç´¢
     */
    @Test
    public void testSearchTemplate() {
        SearchQuery searchQuery = new NativeSearchQueryBuilder()
                .withQuery(QueryBuilders.multiMatchQuery("äº’è”ç½‘å¯’å†¬", "title", "content"))
                .withSort(SortBuilders.fieldSort("type").order(SortOrder.DESC))
                .withSort(SortBuilders.fieldSort("score").order(SortOrder.DESC))
                .withSort(SortBuilders.fieldSort("createTime").order(SortOrder.DESC))
                .withPageable(PageRequest.of(0, 10))
                .withHighlightFields(
                        new HighlightBuilder.Field("title").preTags("<em>").postTags("</em>"),
                        new HighlightBuilder.Field("content").preTags("<em>").postTags("</em>")
                ).build();

        Page<DiscussPost> page = elasticsearchTemplate.queryForPage(searchQuery, DiscussPost.class, new SearchResultMapper() {
            @Override
            public <T> AggregatedPage<T> mapResults(SearchResponse searchResponse, Class<T> aClass, Pageable pageable) {
                SearchHits hits = searchResponse.getHits();
                if (hits.getTotalHits() <= 0) {
                    return null;
                }

                List<DiscussPost> list = new ArrayList<>();

                for (SearchHit hit : hits) {
                    DiscussPost post = new DiscussPost();

                    String id = hit.getSourceAsMap().get("id").toString();
                    post.setId(Integer.valueOf(id));

                    String userId = hit.getSourceAsMap().get("userId").toString();
                    post.setUserId(Integer.valueOf(userId));

                    String title = hit.getSourceAsMap().get("title").toString();
                    post.setTitle(title);

                    String content = hit.getSourceAsMap().get("content").toString();
                    post.setContent(content);

                    String status = hit.getSourceAsMap().get("status").toString();
                    post.setStatus(Integer.valueOf(status));

                    String createTime = hit.getSourceAsMap().get("createTime").toString();
                    post.setCreateTime(new Date(Long.valueOf(createTime)));

                    String commentCount = hit.getSourceAsMap().get("commentCount").toString();
                    post.setCommentCount(Integer.valueOf(commentCount));

                    // å¤„ç†é«˜äº®æ˜¾ç¤ºçš„å†…å®¹
                    HighlightField titleField = hit.getHighlightFields().get("title");
                    if (titleField != null) {
                        post.setTitle(titleField.getFragments()[0].toString());
                    }

                    HighlightField contentField = hit.getHighlightFields().get("content");
                    if (contentField != null) {
                        post.setContent(contentField.getFragments()[0].toString());
                    }

                    list.add(post);
                }

                return new AggregatedPageImpl(list, pageable,
                        hits.getTotalHits(), searchResponse.getAggregations(), searchResponse.getScrollId(), hits.getMaxScore());
    }
});

        System.out.println(page.getTotalElements());
        System.out.println(page.getTotalPages());
        System.out.println(page.getNumber());
        System.out.println(page.getSize());
        for (DiscussPost post : page) {
            System.out.println(post);
        }
    }

}
```

ğŸš¨ æ³¨æ„è¿™é‡Œé¢çš„ Page æ˜¯ Spring æä¾›çš„ï¼Œè€Œéæˆ‘ä»¬è‡ªå·±å¼€å‘çš„é‚£ä¸ªï¼Œå®ƒçš„ current å½“å‰é¡µç æ˜¯ä» 0 å¼€å§‹è®¡æ•°çš„ï¼Œè€Œæˆ‘ä»¬è‡ªå·±å¼€å‘çš„é‚£ä¸ª Page æ˜¯ä» 1 å¼€å§‹çš„ï¼Œæ‰€ä»¥åç»­ç¼–ç çš„æ—¶å€™è®°å¾—ç¨å¾®å¤„ç†ä¸€ä¸‹ã€‚

## å¼€å‘ç¤¾åŒºæœç´¢åŠŸèƒ½

<img src="https://gitee.com/veal98/images/raw/master/img/20210129153411.png" style="zoom: 33%;" />

ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥åœ°ï¼ˆæé«˜æ€§èƒ½ï¼‰å°†å¸–å­æäº¤åˆ° Elasticsearch æäº¤åˆ°æœåŠ¡å™¨

### Service

```java
/**
 * æœç´¢ç›¸å…³
 */
@Service
public class ElasticsearchService {

    @Autowired
    private DiscussPostRepository discussPostRepository;

    @Autowired
    private ElasticsearchTemplate elasticsearchTemplate;

    /**
     * å°†æ•°æ®æ’å…¥ Elasticsearch æœåŠ¡å™¨
     * @param post
     */
    public void saveDiscusspost(DiscussPost post) {
        discussPostRepository.save(post);
    }

    /**
     * å°†æ•°æ®ä» Elasticsearch æœåŠ¡å™¨ä¸­åˆ é™¤
     * @param id
     */
    public void deleteDiscusspost(int id) {
        discussPostRepository.deleteById(id);
    }

    /**
     * æœç´¢
     * @param keyword æœç´¢çš„å…³é”®è¯
     * @param current å½“å‰é¡µç ï¼ˆè¿™é‡Œçš„ Page æ˜¯ Spring æä¾›çš„ï¼Œè€Œéæˆ‘ä»¬è‡ªå·±å®ç°çš„é‚£ä¸ªï¼‰
     * @param limit æ¯é¡µæ˜¾ç¤ºå¤šå°‘æ¡æ•°æ®
     * @return
     */
    public Page<DiscussPost> searchDiscussPost(String keyword, int current, int limit) {
        SearchQuery searchQuery = new NativeSearchQueryBuilder()
                .withQuery(QueryBuilders.multiMatchQuery(keyword, "title", "content"))
                .withSort(SortBuilders.fieldSort("type").order(SortOrder.DESC))
                .withSort(SortBuilders.fieldSort("score").order(SortOrder.DESC))
                .withSort(SortBuilders.fieldSort("createTime").order(SortOrder.DESC))
                .withPageable(PageRequest.of(current, limit))
                .withHighlightFields(
                        new HighlightBuilder.Field("title").preTags("<em>").postTags("</em>"),
                        new HighlightBuilder.Field("content").preTags("<em>").postTags("</em>")
                ).build();

        return elasticsearchTemplate.queryForPage(searchQuery, DiscussPost.class, new SearchResultMapper() {
            @Override
            public <T> AggregatedPage<T> mapResults(SearchResponse searchResponse, Class<T> aClass, Pageable pageable) {
                // è·å–å‘½ä¸­çš„æ•°æ®
                SearchHits hits = searchResponse.getHits();
                if (hits.getTotalHits() <= 0) {
                    return null;
                }

                // å¤„ç†å‘½ä¸­çš„æ•°æ®
                List<DiscussPost> list = new ArrayList<>();
                for (SearchHit hit : hits) {
                    DiscussPost post = new DiscussPost();

                    String id = hit.getSourceAsMap().get("id").toString();
                    post.setId(Integer.valueOf(id));

                    String userId = hit.getSourceAsMap().get("userId").toString();
                    post.setUserId(Integer.valueOf(userId));

                    String title = hit.getSourceAsMap().get("title").toString();
                    post.setTitle(title);

                    String content = hit.getSourceAsMap().get("content").toString();
                    post.setContent(content);

                    String status = hit.getSourceAsMap().get("status").toString();
                    post.setStatus(Integer.valueOf(status));

                    String createTime = hit.getSourceAsMap().get("createTime").toString();
                    post.setCreateTime(new Date(Long.valueOf(createTime)));

                    String commentCount = hit.getSourceAsMap().get("commentCount").toString();
                    post.setCommentCount(Integer.valueOf(commentCount));

                    // å¤„ç†é«˜äº®æ˜¾ç¤ºçš„å†…å®¹
                    HighlightField titleField = hit.getHighlightFields().get("title");
                    if (titleField != null) {
                        post.setTitle(titleField.getFragments()[0].toString());
                    }

                    HighlightField contentField = hit.getHighlightFields().get("content");
                    if (contentField != null) {
                        post.setContent(contentField.getFragments()[0].toString());
                    }

                    list.add(post);
                }

                return new AggregatedPageImpl(list, pageable,
                        hits.getTotalHits(), searchResponse.getAggregations(), searchResponse.getScrollId(), hits.getMaxScore());
            }
        });

    }

}
```

### Controller

- DiscusspostController

  å‘å¸–æˆåŠŸåï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å°†è¯¥å¸–å­å­˜å…¥ Elasticsearch æœåŠ¡å™¨

  <img src="https://gitee.com/veal98/images/raw/master/img/20210129155856.png" style="zoom: 50%;" />

- CommentController

  å¯¹å¸–å­æ·»åŠ è¯„è®ºæˆåŠŸåï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å°†è¯¥å¸–å­å­˜å…¥ Elasticsearch æœåŠ¡å™¨ï¼ˆä¸æ‡‚ä¸ºå•¥è¦è¿™æ ·åšï¼Œåˆä¸ç”¨æŸ¥è¯¢è¯„è®ºï¼‰

  <img src="https://gitee.com/veal98/images/raw/master/img/20210129160046.png" style="zoom:50%;" />

- åœ¨æ¶ˆæ¯é˜Ÿåˆ—æ¶ˆè´¹è€…ä¸­æ·»åŠ ä¸€ä¸ªæ¶ˆè´¹å‘å¸–äº‹ä»¶çš„æ–¹æ³•

  ```java
  /**
   * æ¶ˆè´¹å‘å¸–äº‹ä»¶
   */
  @KafkaListener(topics = {TOPIC_PUBLISH})
  public void handlePublishMessage(ConsumerRecord record) {
      if (record == null || record.value() == null) {
          logger.error("æ¶ˆæ¯çš„å†…å®¹ä¸ºç©º");
          return ;
      }
      Event event = JSONObject.parseObject(record.value().toString(), Event.class);
      if (event == null) {
          logger.error("æ¶ˆæ¯æ ¼å¼é”™è¯¯");
          return ;
      }
  
      DiscussPost post = discussPostSerivce.findDiscussPostById(event.getEntityId());
      elasticsearchService.saveDiscusspost(post);
  
  }
  ```

- **SearchController**

  ```java
  /**
   * æœç´¢
   */
  @Controller
  public class SearchController implements CommunityConstant {
  
      @Autowired
      private ElasticsearchService elasticsearchService;
  
      @Autowired
      private UserService userService;
  
      @Autowired
      private DiscussPostSerivce discussPostSerivce;
  
      @Autowired
      private LikeService likeService;
  
      // search?keword=xxx
      @GetMapping("/search")
      public String search(String keyword, Page page, Model model) {
          // æœç´¢å¸–å­ (Spring æä¾›çš„ Page å½“å‰é¡µç ä» 0 å¼€å§‹è®¡æ•°)
          org.springframework.data.domain.Page<DiscussPost> searchResult =
              elasticsearchService.searchDiscussPost(keyword, page.getCurrent()-1, page.getLimit());
          // èšåˆæ•°æ®
          List<Map<String, Object>> discussPosts = new ArrayList<>();
          if (searchResult != null) {
              for (DiscussPost post : searchResult) {
                  Map<String, Object> map = new HashMap<>();
                  // å¸–å­
                  map.put("post", post);
                  // ä½œè€…
                  map.put("user", userService.findUserById(post.getUserId()));
                  // ç‚¹èµæ•°é‡
                  map.put("likeCount", likeService.findEntityLikeCount(ENTITY_TYPE_POST, post.getId()));
  
                  discussPosts.add(map);
              }
          }
  
          model.addAttribute("discussPosts", discussPosts);
          model.addAttribute("keyword", keyword);
  
          // è®¾ç½®åˆ†é¡µ
          page.setPath("/search?keyword="+ keyword);
          page.setRows(searchResult == null ? 0 : (int) searchResult.getTotalElements());
  
          return "/site/search";
      }
  
  }
  ```

### å‰ç«¯

`index.html` æœç´¢æ¡†

```html
<form method="get" th:action="@{/search}">
   <input name="keyword" th:value="${keyword}" />
   <button type="submit"> æœç´¢</button>
</form>
```

name = "keyword" å’Œ Controller ä¸­å‚æ•°çš„åç§°è¦ä¸€è‡´

`search.html` æœç´¢è¯¦æƒ…é¡µ

```html
<li th:each="map:${discussPosts}">
   <img th:src="${map.user.headerUrl}" alt="ç”¨æˆ·å¤´åƒ">
      <a th:href="@{|/discuss/detail/${map.post.id}|}" th:utext="${map.post.title}"></a>
      <div th:utext="${map.post.content}"></div>
      <u th:utext="${map.user.username}"></u>
      å‘å¸ƒäº <b th:text="${#dates.format(map.post.createTime, 'yyyy-MM-dd HH:mm:ss')}"></b>
      <ul>
        <li>èµ <i th:text="${map.likeCount}"></i></li>
        <li>|</li>
        <li>å›å¤ <i th:text="${map.post.commentCount}"></i></li>
     </ul>
</li>
```
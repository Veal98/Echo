# Echo â€” å¼€æºç¤¾åŒºç³»ç»Ÿ

---

## ğŸ“š ä»æœ¬é¡¹ç›®ä½ èƒ½å­¦åˆ°ä»€ä¹ˆ

- å­¦ä¼šä¸»æµçš„ Java Web å¼€å‘æŠ€æœ¯å’Œæ¡†æ¶ï¼ˆSpringã€SpringBootã€Spring MVCã€MyBatisã€MySQLã€Redisã€Kafkaã€Elasticsearchã€Spring Security ç­‰ï¼‰
- äº†è§£ä¸€ä¸ªçœŸå®çš„ Web é¡¹ç›®ä»å¼€å‘åˆ°éƒ¨ç½²çš„æ•´ä¸ªæµç¨‹ï¼ˆæœ¬é¡¹ç›®é…å¥—æœ‰å¤§é‡å›¾ä¾‹å’Œè¯¦ç»†æ•™ç¨‹ï¼Œä»¥å¸®åŠ©å°ä¼™ä¼´å¿«é€Ÿä¸Šæ‰‹ï¼‰
- æŒæ¡æœ¬é¡¹ç›®ä¸­æ¶‰åŠçš„æ ¸å¿ƒæŠ€æœ¯ç‚¹ä»¥åŠå¸¸è§é¢è¯•é¢˜å’Œè§£æ

## ğŸ„â€ åœ¨çº¿ä½“éªŒä¸æ–‡æ¡£åœ°å€

- åœ¨çº¿ä½“éªŒï¼šé¡¹ç›®å·²ç»éƒ¨ç½²åˆ°è…¾è®¯äº‘æœåŠ¡å™¨ï¼Œå„ä½å°ä¼™ä¼´ä»¬å¯ç›´æ¥çº¿ä¸Šä½“éªŒï¼š[http://1.15.127.74/](http://1.15.127.74/)
- æ–‡æ¡£åœ°å€ï¼šæ–‡æ¡£é€šè¿‡ Vuepress + Gitee Pages ç”Ÿæˆï¼Œåœ¨çº¿è®¿é—®åœ°å€ï¼š

## ğŸ’» æ ¸å¿ƒæŠ€æœ¯æ ˆ

åç«¯ï¼š

- Spring
- Spring Boot 2.1.5 RELEASE
- Spring MVC
- ORMï¼šMyBatis
- æ•°æ®åº“ï¼šMySQL 5.7
- åˆ†å¸ƒå¼ç¼“å­˜ï¼šRedis
- æœ¬åœ°ç¼“å­˜ï¼šCaffeine
- æ¶ˆæ¯é˜Ÿåˆ—ï¼šKafka 2.13-2.7.0
- æœç´¢å¼•æ“ï¼šElasticsearch 6.4.3
- å®‰å…¨ï¼šSpring Security
- é‚®ä»¶ï¼šSpring Mail
- åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡ï¼šSpring Quartz
- æ—¥å¿—ï¼šSLF4Jï¼ˆæ—¥å¿—æ¥å£ï¼‰ + Logbackï¼ˆæ—¥å¿—å®ç°ï¼‰

å‰ç«¯ï¼š

- Thymeleaf
- Bootstrap 4.x
- Jquery
- Ajax

## ğŸ”¨ å¼€å‘ç¯å¢ƒ

- æ“ä½œç³»ç»Ÿï¼šWindows 10
- æ„å»ºå·¥å…·ï¼šApache Maven
- é›†æˆå¼€å‘å·¥å…·ï¼šIntellij IDEA
- åº”ç”¨æœåŠ¡å™¨ï¼šApache Tomcat
- æ¥å£æµ‹è¯•å·¥å…·ï¼šPostman
- å‹åŠ›æµ‹è¯•å·¥å…·ï¼šApache JMeter
- ç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼šGit
- Java ç‰ˆæœ¬ï¼š8

## ğŸ€ ç•Œé¢å±•ç¤º

é¦–é¡µï¼š

![](https://gitee.com/veal98/images/raw/master/img/20210211205641.png)

ç™»å½•é¡µï¼š

![](https://gitee.com/veal98/images/raw/master/img/20210211205558.png)

å¸–å­è¯¦æƒ…é¡µï¼š

![](https://gitee.com/veal98/images/raw/master/img/20210211205741.png)

ä¸ªäººä¸»é¡µï¼š

![](https://gitee.com/veal98/images/raw/master/img/20210211205820.png)

æœ‹å‹ç§ä¿¡é¡µï¼š

![](https://gitee.com/veal98/images/raw/master/img/20210211205857.png)

ç§ä¿¡è¯¦æƒ…é¡µï¼š

![](https://gitee.com/veal98/images/raw/master/img/20210211205948.png)

ç³»ç»Ÿé€šçŸ¥é¡µï¼š

![](https://gitee.com/veal98/images/raw/master/img/20210211210122.png)

é€šçŸ¥è¯¦æƒ…é¡µï¼š

![](https://gitee.com/veal98/images/raw/master/img/20210211210152.png)

è´¦å·è®¾ç½®é¡µï¼š

![](https://gitee.com/veal98/images/raw/master/img/20210211210238.png)

æ•°æ®ç»Ÿè®¡é¡µï¼š

![](https://gitee.com/veal98/images/raw/master/img/20210211210323.png)

æœç´¢è¯¦æƒ…é¡µï¼š

![](https://gitee.com/veal98/images/raw/master/img/20210211210531.png)

## ğŸ¨ åŠŸèƒ½åˆ—è¡¨

![](https://gitee.com/veal98/images/raw/master/img/20210208222403.png)

- [x] **æ³¨å†Œ**

  - ç”¨æˆ·æ³¨å†ŒæˆåŠŸï¼Œå°†ç”¨æˆ·ä¿¡æ¯å­˜å…¥ MySQLï¼Œä½†æ­¤æ—¶è¯¥ç”¨æˆ·çŠ¶æ€ä¸ºæœªæ¿€æ´»
  - å‘ç”¨æˆ·å‘é€æ¿€æ´»é‚®ä»¶ï¼Œç”¨æˆ·ç‚¹å‡»é“¾æ¥åˆ™æ¿€æ´»è´¦å·ï¼ˆSpring Mailï¼‰

- [x] **ç™»å½• | ç™»å‡º**

  - è¿›å…¥ç™»å½•ç•Œé¢ï¼ŒåŠ¨æ€ç”ŸæˆéªŒè¯ç ï¼Œå¹¶å°†éªŒè¯ç çŸ­æš‚å­˜å…¥ Redisï¼ˆ60 ç§’ï¼‰

  - ç”¨æˆ·ç™»å½•æˆåŠŸï¼ˆéªŒè¯ç”¨æˆ·åã€å¯†ç ã€éªŒè¯ç ï¼‰ï¼Œç”Ÿæˆç™»å½•å‡­è¯ä¸”è®¾ç½®çŠ¶æ€ä¸ºæœ‰æ•ˆï¼Œå¹¶å°†ç™»å½•å‡­è¯å­˜å…¥ Redis

    æ³¨æ„ï¼šç™»å½•å‡­è¯å­˜åœ¨æœ‰æ•ˆæœŸï¼Œåœ¨æ‰€æœ‰çš„è¯·æ±‚æ‰§è¡Œä¹‹å‰ï¼Œéƒ½ä¼šæ£€æŸ¥å‡­è¯æ˜¯å¦æœ‰æ•ˆå’Œæ˜¯å¦è¿‡æœŸï¼Œåªè¦è¯¥ç”¨æˆ·çš„å‡­è¯æœ‰æ•ˆå¹¶åœ¨æœ‰æ•ˆæœŸæ—¶é—´å†…ï¼Œæœ¬æ¬¡è¯·æ±‚å°±ä¼šä¸€ç›´æŒæœ‰è¯¥ç”¨æˆ·ä¿¡æ¯ï¼ˆä½¿ç”¨ ThreadLocal æŒæœ‰ç”¨æˆ·ä¿¡æ¯ï¼‰

  - å‹¾é€‰è®°ä½æˆ‘ï¼Œåˆ™å»¶é•¿ç™»å½•å‡­è¯æœ‰æ•ˆæ—¶é—´

  - ç”¨æˆ·ç™»å½•æˆåŠŸï¼Œå°†ç”¨æˆ·ä¿¡æ¯çŸ­æš‚å­˜å…¥ Redisï¼ˆ1 å°æ—¶ï¼‰

  - ç”¨æˆ·ç™»å‡ºï¼Œå°†å‡­è¯çŠ¶æ€è®¾ä¸ºæ— æ•ˆï¼Œå¹¶æ›´æ–° Redis ä¸­è¯¥ç”¨æˆ·çš„ç™»å½•å‡­è¯ä¿¡æ¯

- [x] **è´¦å·è®¾ç½®**

  - ä¿®æ”¹å¤´åƒ
    - å°†ç”¨æˆ·é€‰æ‹©çš„å¤´åƒå›¾ç‰‡æ–‡ä»¶ä¸Šä¼ è‡³ä¸ƒç‰›äº‘æœåŠ¡å™¨
  - ä¿®æ”¹å¯†ç 

- [x] **å¸–å­æ¨¡å—**

  - å‘å¸ƒå¸–å­ï¼ˆè¿‡æ»¤æ•æ„Ÿè¯ï¼‰ï¼Œå°†å…¶å­˜å…¥ MySQL
  - åˆ†é¡µæ˜¾ç¤ºæ‰€æœ‰çš„å¸–å­
    - æ”¯æŒæŒ‰ç…§ â€œå‘å¸–æ—¶é—´â€ æ˜¾ç¤º
    - æ”¯æŒæŒ‰ç…§ â€œçƒ­åº¦æ’è¡Œâ€ æ˜¾ç¤ºï¼ˆSpring Quartzï¼‰
  - æŸ¥çœ‹å¸–å­è¯¦æƒ…
  - æƒé™ç®¡ç†ï¼ˆSpring Security + Thymeleaf Securityï¼‰
    - æœªç™»å½•ç”¨æˆ·æ— æ³•å‘å¸–
    - â€œç‰ˆä¸»â€ å¯ä»¥çœ‹åˆ°å¸–å­çš„ç½®é¡¶å’ŒåŠ ç²¾æŒ‰é’®å¹¶æ‰§è¡Œç›¸åº”æ“ä½œ
    - â€œç®¡ç†å‘˜â€ å¯ä»¥çœ‹åˆ°å¸–å­çš„åˆ é™¤æŒ‰é’®å¹¶æ‰§è¡Œç›¸åº”æ“ä½œ
    - â€œæ™®é€šç”¨æˆ·â€ æ— æ³•çœ‹åˆ°å¸–å­çš„ç½®é¡¶ã€åŠ ç²¾ã€åˆ é™¤æŒ‰é’®ï¼Œä¹Ÿæ— æ³•æ‰§è¡Œç›¸åº”æ“ä½œ

- [x] **è¯„è®ºæ¨¡å—**

  - å‘å¸ƒå¯¹å¸–å­çš„è¯„è®ºï¼ˆè¿‡æ»¤æ•æ„Ÿè¯ï¼‰ï¼Œå°†å…¶å­˜å…¥ MySQL
  - åˆ†é¡µæ˜¾ç¤ºè¯„è®º
  - å‘å¸ƒå¯¹è¯„è®ºçš„å›å¤ï¼ˆè¿‡æ»¤æ•æ„Ÿè¯ï¼‰
  - æƒé™ç®¡ç†ï¼ˆSpring Securityï¼‰
    - æœªç™»å½•ç”¨æˆ·æ— æ³•ä½¿ç”¨è¯„è®ºåŠŸèƒ½

- [x] **ç§ä¿¡æ¨¡å—**

  - å‘é€ç§ä¿¡ï¼ˆè¿‡æ»¤æ•æ„Ÿè¯ï¼‰
  - ç§ä¿¡åˆ—è¡¨
    - æŸ¥è¯¢å½“å‰ç”¨æˆ·çš„ä¼šè¯åˆ—è¡¨
    - æ¯ä¸ªä¼šè¯åªæ˜¾ç¤ºä¸€æ¡æœ€æ–°çš„ç§ä¿¡
    - æ”¯æŒåˆ†é¡µæ˜¾ç¤º
  - ç§ä¿¡è¯¦æƒ…
    - æŸ¥è¯¢æŸä¸ªä¼šè¯æ‰€åŒ…å«çš„æ‰€æœ‰ç§ä¿¡
    - è®¿é—®ç§ä¿¡è¯¦æƒ…æ—¶ï¼Œå°†æ˜¾ç¤ºçš„ç§ä¿¡è®¾ä¸ºå·²è¯»çŠ¶æ€
    - æ”¯æŒåˆ†é¡µæ˜¾ç¤º
  - æƒé™ç®¡ç†ï¼ˆSpring Securityï¼‰
    - æœªç™»å½•ç”¨æˆ·æ— æ³•ä½¿ç”¨ç§ä¿¡åŠŸèƒ½

- [x] **ç»Ÿä¸€å¤„ç† 404 / 500 å¼‚å¸¸**

  - æ™®é€šè¯·æ±‚å¼‚å¸¸
  - å¼‚æ­¥è¯·æ±‚å¼‚å¸¸

- [x] **ç»Ÿä¸€è®°å½•æ—¥å¿—**

- [x] **ç‚¹èµæ¨¡å—**

  - æ”¯æŒå¯¹å¸–å­ã€è¯„è®º/å›å¤ç‚¹èµ
  - ç¬¬ 1 æ¬¡ç‚¹èµï¼Œç¬¬ 2 æ¬¡å–æ¶ˆç‚¹èµ
  - é¦–é¡µç»Ÿè®¡å¸–å­çš„ç‚¹èµæ•°é‡
  - è¯¦æƒ…é¡µç»Ÿè®¡å¸–å­å’Œè¯„è®º/å›å¤çš„ç‚¹èµæ•°é‡
  - è¯¦æƒ…é¡µæ˜¾ç¤ºå½“å‰ç™»å½•ç”¨æˆ·çš„ç‚¹èµçŠ¶æ€ï¼ˆèµè¿‡äº†åˆ™æ˜¾ç¤ºå·²èµï¼‰

  - ç»Ÿè®¡æˆ‘çš„è·èµæ•°é‡
  - æƒé™ç®¡ç†ï¼ˆSpring Securityï¼‰
    - æœªç™»å½•ç”¨æˆ·æ— æ³•ä½¿ç”¨ç‚¹èµç›¸å…³åŠŸèƒ½

- [x] **å…³æ³¨æ¨¡å—**

  - å…³æ³¨åŠŸèƒ½
  - å–æ¶ˆå…³æ³¨åŠŸèƒ½
  - ç»Ÿè®¡ç”¨æˆ·çš„å…³æ³¨æ•°å’Œç²‰ä¸æ•°
  - æˆ‘çš„å…³æ³¨åˆ—è¡¨ï¼ˆæŸ¥è¯¢æŸä¸ªç”¨æˆ·å…³æ³¨çš„äººï¼‰ï¼Œæ”¯æŒåˆ†é¡µ
  - æˆ‘çš„ç²‰ä¸åˆ—è¡¨ï¼ˆæŸ¥è¯¢æŸä¸ªç”¨æˆ·çš„ç²‰ä¸ï¼‰ï¼Œæ”¯æŒåˆ†é¡µ
  - æƒé™ç®¡ç†ï¼ˆSpring Securityï¼‰
    - æœªç™»å½•ç”¨æˆ·æ— æ³•ä½¿ç”¨å…³æ³¨ç›¸å…³åŠŸèƒ½

- [x] **ç³»ç»Ÿé€šçŸ¥æ¨¡å—**

  - é€šçŸ¥åˆ—è¡¨
    - æ˜¾ç¤ºè¯„è®ºã€ç‚¹èµã€å…³æ³¨ä¸‰ç§ç±»å‹çš„é€šçŸ¥
  - é€šçŸ¥è¯¦æƒ…
    - åˆ†é¡µæ˜¾ç¤ºæŸä¸€ç±»ä¸»é¢˜æ‰€åŒ…å«çš„é€šçŸ¥
    - è¿›å…¥æŸç§ç±»å‹çš„ç³»ç»Ÿé€šçŸ¥è¯¦æƒ…ï¼Œåˆ™å°†è¯¥é¡µçš„æ‰€æœ‰æœªè¯»çš„ç³»ç»Ÿé€šçŸ¥çŠ¶æ€è®¾ç½®ä¸ºå·²è¯»
  - æœªè¯»æ•°é‡
    - åˆ†åˆ«æ˜¾ç¤ºæ¯ç§ç±»å‹çš„ç³»ç»Ÿé€šçŸ¥çš„æœªè¯»æ•°é‡
    - æ˜¾ç¤ºæ‰€æœ‰ç³»ç»Ÿé€šçŸ¥çš„æœªè¯»æ•°é‡
  - å¯¼èˆªæ æ˜¾ç¤ºæ‰€æœ‰æ¶ˆæ¯çš„æœªè¯»æ•°é‡ï¼ˆæœªè¯»ç§ä¿¡ + æœªè¯»ç³»ç»Ÿé€šçŸ¥ï¼‰
  - æƒé™ç®¡ç†ï¼ˆSpring Securityï¼‰
    - æœªç™»å½•ç”¨æˆ·æ— æ³•ä½¿ç”¨ç³»ç»Ÿé€šçŸ¥åŠŸèƒ½

- [x] **æœç´¢æ¨¡å—**

  - å‘å¸ƒäº‹ä»¶
    - å‘å¸ƒå¸–å­æ—¶ï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å°†å¸–å­å¼‚æ­¥åœ°æäº¤åˆ° Elasticsearch æœåŠ¡å™¨
    - ä¸ºå¸–å­å¢åŠ è¯„è®ºæ—¶ï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å°†å¸–å­å¼‚æ­¥åœ°æäº¤åˆ° Elasticsearch æœåŠ¡å™¨
  - æœç´¢æœåŠ¡
    - ä» Elasticsearch æœåŠ¡å™¨æœç´¢å¸–å­
    - ä» Elasticsearch æœåŠ¡å™¨åˆ é™¤å¸–å­ï¼ˆå½“å¸–å­ä»æ•°æ®åº“ä¸­è¢«åˆ é™¤æ—¶ï¼‰
  - æ˜¾ç¤ºæœç´¢ç»“æœ

- [x] **ç½‘ç«™æ•°æ®ç»Ÿè®¡**ï¼ˆç®¡ç†å‘˜ä¸“å±ï¼‰

  - ç‹¬ç«‹è®¿å®¢ UV
    - å­˜å…¥ Redis çš„ HyperLogLog
    - æ”¯æŒå•æ—¥æŸ¥è¯¢å’ŒåŒºé—´æ—¥æœŸæŸ¥è¯¢
  - æ—¥æ´»è·ƒç”¨æˆ· DAU
    - å­˜å…¥ Redis çš„ Bitmap
    - æ”¯æŒå•æ—¥æŸ¥è¯¢å’ŒåŒºé—´æ—¥æœŸæŸ¥è¯¢
  - æƒé™ç®¡ç†ï¼ˆSpring Securityï¼‰
    - åªæœ‰ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹ç½‘ç«™æ•°æ®ç»Ÿè®¡

- [x] ä¼˜åŒ–ç½‘ç«™æ€§èƒ½

  - ä½¿ç”¨æœ¬åœ°ç¼“å­˜ Caffeine ç¼“å­˜çƒ­å¸–åˆ—è¡¨ä»¥åŠæ‰€æœ‰ç”¨æˆ·å¸–å­çš„æ€»æ•°

## ğŸ” å¾…å®ç°åŠä¼˜åŒ–

ä»¥ä¸‹æ˜¯æˆ‘ä¸ªäººå‘ç°çš„æœ¬é¡¹ç›®å­˜åœ¨çš„é—®é¢˜ï¼Œä½†æ˜¯æš‚æ—¶æ²¡æœ‰å¤´ç»ªæ— æ³•è§£å†³ï¼Œé›†æ€å¹¿ç›Šï¼Œæ¬¢è¿å„ä½å°ä¼™ä¼´æ PR è§£å†³ï¼š

- [ ] æ³¨å†Œæ¨¡å—æ— æ³•æ­£å¸¸è·³è½¬åˆ°æ“ä½œæç¤ºç•Œé¢ï¼ˆæœ¬åœ°è¿è¡Œæ²¡æœ‰é—®é¢˜ï¼‰
- [ ] è¯„è®ºåŠŸèƒ½çš„å‰ç«¯æ˜¾ç¤ºéƒ¨åˆ†å­˜åœ¨ Bug
- [ ] æŸ¥è¯¢æˆ‘çš„è¯„è®ºï¼ˆæœªå®Œå–„ï¼‰

ä»¥ä¸‹æ˜¯æˆ‘è§‰å¾—æœ¬é¡¹ç›®è¿˜å¯ä»¥æ·»åŠ çš„åŠŸèƒ½ï¼ŒåŒæ ·æ¬¢è¿å„ä½å°ä¼™ä¼´æ issue æŒ‡å‡ºè¿˜å¯ä»¥å¢åŠ å“ªäº›åŠŸèƒ½ï¼Œæˆ–è€…ç›´æ¥æ PR å®ç°è¯¥åŠŸèƒ½ï¼š

- [ ] å¿˜è®°å¯†ç ï¼ˆå‘é€é‚®ä»¶æ‰¾å›å¯†ç ï¼‰
- [ ] æŸ¥è¯¢æˆ‘çš„ç‚¹èµ
- [ ] ç®¡ç†å‘˜å¯¹å¸–å­çš„äºŒæ¬¡ç‚¹å‡»å–æ¶ˆç½®é¡¶åŠŸèƒ½
- [ ] ç®¡ç†å‘˜å¯¹å·²åˆ é™¤å¸–å­çš„æ¢å¤åŠŸèƒ½ï¼ˆæœ¬é¡¹ç›®ä¸­çš„åˆ é™¤å¸–å­å¹¶æœªå°†å…¶ä»æ•°æ®åº“ä¸­åˆ é™¤ï¼Œåªæ˜¯å°†å…¶çŠ¶æ€è®¾ç½®ä¸ºäº†æ‹‰é»‘ï¼‰

## ğŸŒ± æœ¬åœ°è¿è¡Œ

å„ä½å¦‚æœéœ€è¦å°†é¡¹ç›®éƒ¨ç½²åœ¨æœ¬åœ°è¿›è¡Œæµ‹è¯•ï¼Œä»¥ä¸‹ç¯å¢ƒè¯·æå‰å¤‡å¥½ï¼š

- Java 8
- MySQL 5.7
- Redis
- Kafka 2.13-2.7.0
- Elasticsearch 6.4.3

ç„¶å**ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ä¿¡æ¯ä¸ºä½ è‡ªå·±çš„æœ¬åœ°ç¯å¢ƒï¼Œç›´æ¥è¿è¡Œæ˜¯è¿è¡Œä¸äº†çš„**ï¼Œè€Œä¸”ç›¸å…³ç§å¯†ä¿¡æ¯æˆ‘å…¨éƒ¨ç”¨ xxxxxxx ä»£æ›¿äº†ã€‚

æœ¬åœ°è¿è¡Œéœ€è¦ä¿®æ”¹çš„é…ç½®æ–‡ä»¶ä¿¡æ¯å¦‚ä¸‹ï¼š

1ï¼‰`application-develop.properties`ï¼š

- MySQL
- Spring Mailï¼ˆé‚®ç®±éœ€è¦å¼€å¯ SMTP æœåŠ¡ï¼‰
- Kafkaï¼šconsumer.group-idï¼ˆè¯¥å­—æ®µè§ Kafka å®‰è£…åŒ…ä¸­çš„ consumer.proertiesï¼Œå¯è‡ªè¡Œä¿®æ”¹, ä¿®æ”¹å®Œæ¯•åéœ€è¦é‡å¯ Kafkaï¼‰
- Elasticsearchï¼šcluster-nameï¼ˆè¯¥å­—æ®µè§ Elasticsearch å®‰è£…åŒ…ä¸­çš„ elasticsearch.ymlï¼Œå¯è‡ªè¡Œä¿®æ”¹ï¼‰
- ä¸ƒç‰›äº‘ï¼ˆéœ€è¦æ–°å»ºä¸€ä¸ªä¸ƒç‰›äº‘çš„å¯¹è±¡å­˜å‚¨ç©ºé—´ï¼Œç”¨æ¥å­˜æ”¾ä¸Šä¼ çš„å¤´åƒå›¾ç‰‡ï¼‰

2ï¼‰`logback-spring-develop.xml`ï¼š

- LOG_PATHï¼šæ—¥å¿—å­˜æ”¾çš„ä½ç½®

æ¯æ¬¡è¿è¡Œéœ€è¦æ‰“å¼€ï¼š

- MySQL
- Redis
- Elasticsearch
- Kafka

å¦å¤–ï¼Œè¿˜éœ€è¦äº‹ä»¶å»ºå¥½æ•°æ®åº“è¡¨ï¼Œè¯¦ç»†è§ä¸‹æ–‡ã€‚

## ğŸ“œ æ•°æ®åº“è®¾è®¡

ç”¨æˆ· `user`ï¼š

```sql
DROP TABLE IF EXISTS `user`;
SET character_set_client = utf8mb4 ;
CREATE TABLE `user` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `username` varchar(50) DEFAULT NULL,
  `password` varchar(50) DEFAULT NULL,
  `salt` varchar(50) DEFAULT NULL,
  `email` varchar(100) DEFAULT NULL,
  `type` int(11) DEFAULT NULL COMMENT '0-æ™®é€šç”¨æˆ·; 1-è¶…çº§ç®¡ç†å‘˜; 2-ç‰ˆä¸»;',
  `status` int(11) DEFAULT NULL COMMENT '0-æœªæ¿€æ´»; 1-å·²æ¿€æ´»;',
  `activation_code` varchar(100) DEFAULT NULL,
  `header_url` varchar(200) DEFAULT NULL,
  `create_time` timestamp NULL DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `index_username` (`username`(20)),
  KEY `index_email` (`email`(20))
) ENGINE=InnoDB AUTO_INCREMENT=101 DEFAULT CHARSET=utf8;
```

è®¨è®ºå¸– `discuss_post`ï¼š

```sql
DROP TABLE IF EXISTS `discuss_post`;
SET character_set_client = utf8mb4 ;
CREATE TABLE `discuss_post` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `user_id` int(11) DEFAULT NULL,
  `title` varchar(100) DEFAULT NULL,
  `content` text,
  `type` int(11) DEFAULT NULL COMMENT '0-æ™®é€š; 1-ç½®é¡¶;',
  `status` int(11) DEFAULT NULL COMMENT '0-æ­£å¸¸; 1-ç²¾å; 2-æ‹‰é»‘;',
  `create_time` timestamp NULL DEFAULT NULL,
  `comment_count` int(11) DEFAULT NULL,
  `score` double DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `index_user_id` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
```

è¯„è®ºï¼ˆå›å¤ï¼‰`comment`ï¼š

```sql
CREATE TABLE `comment` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `user_id` int(11) DEFAULT NULL,
  `entity_type` int(11) DEFAULT NULL COMMENT 'è¯„è®ºç›®æ ‡çš„ç±»åˆ«ï¼š1 å¸–å­ï¼›2 è¯„è®º ',
  `entity_id` int(11) DEFAULT NULL COMMENT 'è¯„è®ºç›®æ ‡çš„ id',
  `target_id` int(11) DEFAULT NULL COMMENT 'æŒ‡æ˜å¯¹è°è¿›è¡Œè¯„è®º',
  `content` text,
  `status` int(11) DEFAULT NULL COMMENT 'çŠ¶æ€ï¼š0 æ­£å¸¸ï¼›1 ç¦ç”¨',
  `create_time` timestamp NULL DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `index_user_id` (`user_id`),
  KEY `index_entity_id` (`entity_id`)
) ENGINE=InnoDB AUTO_INCREMENT=247 DEFAULT CHARSET=utf8;
```

ç§ä¿¡ `message`ï¼š

```sql
DROP TABLE IF EXISTS `message`;
SET character_set_client = utf8mb4 ;
CREATE TABLE `message` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `from_id` int(11) DEFAULT NULL,
  `to_id` int(11) DEFAULT NULL,
  `conversation_id` varchar(45) NOT NULL,
  `content` text,
  `status` int(11) DEFAULT NULL COMMENT '0-æœªè¯»;1-å·²è¯»;2-åˆ é™¤;',
  `create_time` timestamp NULL DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `index_from_id` (`from_id`),
  KEY `index_to_id` (`to_id`),
  KEY `index_conversation_id` (`conversation_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
```

## ğŸŒŒ ç†æƒ³çš„éƒ¨ç½²æ¶æ„

æˆ‘æ¯ä¸ªéƒ½åªéƒ¨ç½²äº†ä¸€å°ï¼Œä»¥ä¸‹æ˜¯ç†æƒ³çš„éƒ¨ç½²æ¶æ„ï¼š

![](https://gitee.com/veal98/images/raw/master/img/20210211204207.png)

## ğŸ¯ åŠŸèƒ½é€»è¾‘å›¾

ç”»äº†ä¸€äº›ä¸æ˜¯é‚£ä¹ˆä¸¥è°¨çš„å›¾å¸®åŠ©å„ä½å°ä¼™ä¼´ç†æ¸…æ€ç»ªã€‚

> å•å‘ç»¿è‰²ç®­å¤´ï¼š
>
> - å‰ç«¯æ¨¡æ¿ -> Controllerï¼šè¡¨ç¤ºè¿™ä¸ªå‰ç«¯æ¨¡æ¿ä¸­æœ‰ä¸€ä¸ªè¶…é“¾æ¥æ˜¯ç”±è¿™ä¸ª Controller å¤„ç†çš„
> - Controller -> å‰ç«¯æ¨¡æ¿ï¼šè¡¨ç¤ºè¿™ä¸ª Controller ä¼šåƒè¯¥å‰ç«¯æ¨¡æ¿ä¼ é€’æ•°æ®æˆ–è€…è·³è½¬
>
> åŒå‘ç»¿è‰²ç®­å¤´ï¼šè¡¨ç¤º Controller å’Œå‰ç«¯æ¨¡æ¿ä¹‹é—´è¿›è¡Œå‚æ•°çš„ç›¸äº’ä¼ é€’æˆ–ä½¿ç”¨
>
> å•å‘è“è‰²ç®­å¤´ï¼š A -> Bï¼Œè¡¨ç¤º A æ–¹æ³•è°ƒç”¨äº† B æ–¹æ³•
>
> å•å‘çº¢è‰²ç®­å¤´ï¼šæ•°æ®åº“æˆ–ç¼“å­˜æ“ä½œ

### æ³¨å†Œ

- ç”¨æˆ·æ³¨å†ŒæˆåŠŸï¼Œå°†ç”¨æˆ·ä¿¡æ¯å­˜å…¥ MySQLï¼Œä½†æ­¤æ—¶è¯¥ç”¨æˆ·çŠ¶æ€ä¸ºæœªæ¿€æ´»
- å‘ç”¨æˆ·å‘é€æ¿€æ´»é‚®ä»¶ï¼Œç”¨æˆ·ç‚¹å‡»é“¾æ¥åˆ™æ¿€æ´»è´¦å·ï¼ˆSpring Mailï¼‰

![](https://gitee.com/veal98/images/raw/master/img/20210204222249.png)

### ç™»å½• | ç™»å‡º

- è¿›å…¥ç™»å½•ç•Œé¢ï¼ŒåŠ¨æ€ç”ŸæˆéªŒè¯ç ï¼Œå¹¶å°†éªŒè¯ç çŸ­æš‚å­˜å…¥ Redisï¼ˆ60 ç§’ï¼‰

- ç”¨æˆ·ç™»å½•æˆåŠŸï¼ˆéªŒè¯ç”¨æˆ·åã€å¯†ç ã€éªŒè¯ç ï¼‰ï¼Œç”Ÿæˆç™»å½•å‡­è¯ä¸”è®¾ç½®çŠ¶æ€ä¸ºæœ‰æ•ˆï¼Œå¹¶å°†ç™»å½•å‡­è¯å­˜å…¥ Redis

  æ³¨æ„ï¼šç™»å½•å‡­è¯å­˜åœ¨æœ‰æ•ˆæœŸï¼Œåœ¨æ‰€æœ‰çš„è¯·æ±‚æ‰§è¡Œä¹‹å‰ï¼Œéƒ½ä¼šæ£€æŸ¥å‡­è¯æ˜¯å¦æœ‰æ•ˆå’Œæ˜¯å¦è¿‡æœŸï¼Œåªè¦è¯¥ç”¨æˆ·çš„å‡­è¯æœ‰æ•ˆå¹¶åœ¨æœ‰æ•ˆæœŸæ—¶é—´å†…ï¼Œæœ¬æ¬¡è¯·æ±‚å°±ä¼šä¸€ç›´æŒæœ‰è¯¥ç”¨æˆ·ä¿¡æ¯ï¼ˆä½¿ç”¨ ThreadLocal æŒæœ‰ç”¨æˆ·ä¿¡æ¯ï¼‰

- å‹¾é€‰è®°ä½æˆ‘ï¼Œåˆ™å»¶é•¿ç™»å½•å‡­è¯æœ‰æ•ˆæ—¶é—´

- ç”¨æˆ·ç™»å½•æˆåŠŸï¼Œå°†ç”¨æˆ·ä¿¡æ¯çŸ­æš‚å­˜å…¥ Redisï¼ˆ1 å°æ—¶ï¼‰

- ç”¨æˆ·ç™»å‡ºï¼Œå°†å‡­è¯çŠ¶æ€è®¾ä¸ºæ— æ•ˆï¼Œå¹¶æ›´æ–° Redis ä¸­è¯¥ç”¨æˆ·çš„ç™»å½•å‡­è¯ä¿¡æ¯

ä¸‹å›¾æ˜¯ç™»å½•æ¨¡å—çš„åŠŸèƒ½é€»è¾‘å›¾ï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨ Spring Security æä¾›çš„è®¤è¯é€»è¾‘ï¼ˆæˆ‘è§‰å¾—è¿™ä¸ªæ¨¡å—æ˜¯æœ€å¤æ‚çš„ï¼Œè¿™å¼ å›¾å…¶å®å¾ˆå¤šç»†èŠ‚è¿˜æ²¡æœ‰ç”»å…¨ï¼‰

![](https://gitee.com/veal98/images/raw/master/img/20210204233233.png)

### åˆ†é¡µæ˜¾ç¤ºæ‰€æœ‰çš„å¸–å­

- æ”¯æŒæŒ‰ç…§ â€œå‘å¸–æ—¶é—´â€ æ˜¾ç¤º
- æ”¯æŒæŒ‰ç…§ â€œçƒ­åº¦æ’è¡Œâ€ æ˜¾ç¤ºï¼ˆSpring Quartzï¼‰
- å°†çƒ­å¸–åˆ—è¡¨å’Œæ‰€æœ‰å¸–å­çš„æ€»æ•°å­˜å…¥æœ¬åœ°ç¼“å­˜ Caffeineï¼ˆåˆ©ç”¨åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡ Spring Quartz æ¯éš”ä¸€æ®µæ—¶é—´å°±åˆ·æ–°è®¡ç®—å¸–å­çš„çƒ­åº¦/åˆ†æ•° â€” è§ä¸‹æ–‡ï¼Œè€Œ Caffeine é‡Œçš„æ•°æ®æ›´æ–°ä¸ç”¨æˆ‘ä»¬æ“å¿ƒï¼Œå®ƒå¤©ç”Ÿå°±ä¼šè‡ªåŠ¨çš„æ›´æ–°å®ƒæ‹¥æœ‰çš„æ•°æ®ï¼Œç»™å®ƒä¸€ä¸ªåˆå§‹åŒ–æ–¹æ³•å°±å®Œäº‹å„¿ï¼‰

![](https://gitee.com/veal98/images/raw/master/img/20210204222822.png)



### è´¦å·è®¾ç½®

- ä¿®æ”¹å¤´åƒï¼ˆå¼‚æ­¥è¯·æ±‚ï¼‰
  - å°†ç”¨æˆ·é€‰æ‹©çš„å¤´åƒå›¾ç‰‡æ–‡ä»¶ä¸Šä¼ è‡³ä¸ƒç‰›äº‘æœåŠ¡å™¨
- ä¿®æ”¹å¯†ç 

æ­¤å¤„åªç”»å‡ºä¿®æ”¹å¤´åƒï¼š

![](https://gitee.com/veal98/images/raw/master/img/20210206121201.png)

### å‘å¸ƒå¸–å­ï¼ˆå¼‚æ­¥è¯·æ±‚ï¼‰

![](https://gitee.com/veal98/images/raw/master/img/20210206122521.png)

### æ˜¾ç¤ºè¯„è®ºåŠç›¸å…³ä¿¡æ¯

> è¯„è®ºéƒ¨åˆ†å‰ç«¯çš„åç§°æ˜¾ç¤ºæœ‰äº›ç¼ºé™·ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´æ¬¢è¿æ PR è§£å†³~

å…³äºè¯„è®ºæ¨¡å—éœ€è¦æ³¨æ„çš„å°±æ˜¯è¯„è®ºè¡¨çš„è®¾è®¡ï¼ŒæŠŠæ¡å…¶ä¸­å­—æ®µçš„å«ä¹‰ï¼Œæ‰èƒ½é€å½»äº†è§£è¿™ä¸ªåŠŸèƒ½çš„é€»è¾‘ã€‚

è¯„è®º Comment çš„ç›®æ ‡ç±»å‹ï¼ˆå¸–å­ï¼Œè¯„è®ºï¼‰ entityType å’Œ entityId ä»¥åŠå¯¹å“ªä¸ªç”¨æˆ·è¿›è¡Œè¯„è®º/å›å¤ targetId æ˜¯ç”±å‰ç«¯ä¼ é€’ç»™ DiscussPostController çš„

![](https://gitee.com/veal98/images/raw/master/img/20210207150925.png)

ä¸€ä¸ªå¸–å­çš„è¯¦æƒ…é¡µéœ€è¦å°è£…çš„ä¿¡æ¯å¤§æ¦‚å¦‚ä¸‹ï¼š

![](https://gitee.com/veal98/images/raw/master/img/20210207151328.png)

### æ·»åŠ è¯„è®ºï¼ˆäº‹åŠ¡ç®¡ç†ï¼‰

![](https://gitee.com/veal98/images/raw/master/img/20210207122908.png)

### ç§ä¿¡åˆ—è¡¨å’Œè¯¦æƒ…é¡µ

![](https://gitee.com/veal98/images/raw/master/img/20210207161130.png)

### å‘é€ç§ä¿¡ï¼ˆå¼‚æ­¥è¯·æ±‚ï¼‰

![](https://gitee.com/veal98/images/raw/master/img/20210207161500.png)

### ç‚¹èµï¼ˆå¼‚æ­¥è¯·æ±‚ï¼‰

å°†ç‚¹èµç›¸å…³ä¿¡æ¯å­˜å…¥ Redis çš„æ•°æ®ç»“æ„ set ä¸­ã€‚å…¶ä¸­ï¼Œkey å‘½åä¸º  `like:entity:entityType:entityId`ï¼Œvalue å³ç‚¹èµç”¨æˆ·çš„ idã€‚æ¯”å¦‚ key =  `like:entity:2:246`  value =  `11` è¡¨ç¤ºç”¨æˆ· 11 å¯¹å®ä½“ç±»å‹ 2 å³è¯„è®ºè¿›è¡Œäº†ç‚¹èµï¼Œè¯¥è¯„è®ºçš„ id æ˜¯ 246

æŸä¸ªç”¨æˆ·çš„è·èµæ•°é‡å¯¹åº”çš„å­˜å‚¨åœ¨ Redis ä¸­çš„ key æ˜¯ `like:user:userId`ï¼Œvalue å°±æ˜¯è¿™ä¸ªç”¨æˆ·çš„è·èµæ•°é‡

![](https://gitee.com/veal98/images/raw/master/img/20210207165837.png)

### æˆ‘çš„è·èµæ•°é‡

![](https://gitee.com/veal98/images/raw/master/img/20210207170003.png)

### å…³æ³¨ï¼ˆå¼‚æ­¥è¯·æ±‚ï¼‰

- è‹¥ A å…³æ³¨äº† Bï¼Œåˆ™ A æ˜¯ B çš„ç²‰ä¸ Followerï¼ŒB æ˜¯ A çš„ç›®æ ‡ Followee
- å…³æ³¨çš„ç›®æ ‡å¯ä»¥æ˜¯ç”¨æˆ·ã€å¸–å­ã€é¢˜ç›®ç­‰ï¼Œåœ¨å®ç°æ—¶å°†è¿™äº›ç›®æ ‡æŠ½è±¡ä¸ºå®ä½“ï¼ˆç›®å‰åªåšäº†å…³æ³¨ç”¨æˆ·ï¼‰

å°†æŸä¸ªç”¨æˆ·å…³æ³¨çš„å®ä½“ç›¸å…³ä¿¡æ¯å­˜å‚¨åœ¨ Redis çš„æ•°æ®ç»“æ„ zset ä¸­ï¼škey æ˜¯ `followee:userId:entityType` ï¼Œå¯¹åº”çš„ value æ˜¯ `zset(entityId, now)` ï¼Œä»¥å…³æ³¨çš„æ—¶é—´è¿›è¡Œæ’åºã€‚æ¯”å¦‚è¯´ `followee:111:3` å¯¹åº”çš„value `(20, 2020-02-03-xxxx)`ï¼Œè¡¨æ˜ç”¨æˆ· 111 å…³æ³¨äº†å®ä½“ç±»å‹ä¸º 3 å³äºº(ç”¨æˆ·)ï¼Œè¯¥å¸–å­çš„ id æ˜¯ 20ï¼Œå…³æ³¨è¯¥å¸–å­çš„æ—¶é—´æ˜¯ 2020-02-03-xxxx

åŒæ ·çš„ï¼Œå°†æŸä¸ªå®ä½“æ‹¥æœ‰çš„ç²‰ä¸ç›¸å…³ä¿¡æ¯ä¹Ÿå­˜å‚¨åœ¨ Redis çš„æ•°æ®ç»“æ„ zset ä¸­ï¼škey æ˜¯ `follower:entityType:entityId`ï¼Œå¯¹åº”çš„ value æ˜¯ `zset(userId, now)`ï¼Œä»¥å…³æ³¨çš„æ—¶é—´è¿›è¡Œæ’åº

![](https://gitee.com/veal98/images/raw/master/img/20210207174046.png)

### å…³æ³¨åˆ—è¡¨

![](https://gitee.com/veal98/images/raw/master/img/20210207175621.png)

### å‘é€ç³»ç»Ÿé€šçŸ¥

![](https://gitee.com/veal98/images/raw/master/img/20210207182917.png)

### æ˜¾ç¤ºç³»ç»Ÿé€šçŸ¥

![](https://gitee.com/veal98/images/raw/master/img/20210208153059.png)

### æœç´¢

![](https://gitee.com/veal98/images/raw/master/img/20210208161936.png)

ç±»ä¼¼çš„ï¼Œç½®é¡¶ã€åŠ ç²¾ä¹Ÿä¼šè§¦å‘å‘å¸–äº‹ä»¶ï¼Œå°±ä¸å†å›¾é‡Œé¢ç”»å‡ºæ¥äº†ã€‚

### ç½®é¡¶åŠ ç²¾åˆ é™¤ï¼ˆå¼‚æ­¥è¯·æ±‚ï¼‰

![](https://gitee.com/veal98/images/raw/master/img/20210208171729.png)

### ç½‘ç«™æ•°æ®ç»Ÿè®¡

![](https://gitee.com/veal98/images/raw/master/img/20210208170801.png)

### å¸–å­çƒ­åº¦è®¡ç®—

æ¯æ¬¡å‘ç”Ÿç‚¹èµï¼ˆç»™å¸–å­ç‚¹èµï¼‰ã€è¯„è®ºï¼ˆç»™å¸–å­è¯„è®ºï¼‰ã€åŠ ç²¾çš„æ—¶å€™ï¼Œå°±å°†è¿™äº›å¸–å­ä¿¡æ¯å­˜å…¥ç¼“å­˜ Redis ä¸­ï¼Œç„¶åé€šè¿‡åˆ†å¸ƒå¼çš„å®šæ—¶ä»»åŠ¡ Spring Quartzï¼Œæ¯éš”ä¸€æ®µæ—¶é—´å°±ä»ç¼“å­˜ä¸­å–å‡ºè¿™äº›å¸–å­è¿›è¡Œè®¡ç®—åˆ†æ•°ã€‚

å¸–å­åˆ†æ•°/çƒ­åº¦è®¡ç®—å…¬å¼ï¼šåˆ†æ•°ï¼ˆçƒ­åº¦ï¼‰ = æƒé‡ + å‘å¸–è·ç¦»å¤©æ•°

```java
// è®¡ç®—æƒé‡
double w = (wonderful ? 75 : 0) + commentCount * 10 + likeCount * 2;
// åˆ†æ•° = æƒé‡ + å‘å¸–è·ç¦»å¤©æ•°
double score = Math.log10(Math.max(w, 1))
        + (post.getCreateTime().getTime() - epoch.getTime()) / (1000 * 3600 * 24);
```

![](https://gitee.com/veal98/images/raw/master/img/20210208173636.png)

## ğŸ“– é…å¥—æ•™ç¨‹

æƒ³è¦è‡ªå·±ä»é›¶å¼€å§‹å®ç°è¿™ä¸ªé¡¹ç›®æˆ–è€…æ·±å…¥ç†è§£çš„å°ä¼™ä¼´ï¼Œå¯ä»¥æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨å…¬ä¼—å·ã€**é£å¤©å°ç‰›è‚‰**ã€ï¼Œç¬¬ä¸€æ—¶é—´è·å–é…å¥—æ•™ç¨‹, ä¸ä»…ä¼šè¯¦ç»†è§£é‡Šæœ¬é¡¹ç›®æ¶‰åŠçš„å„å¤§æŠ€æœ¯ç‚¹ï¼Œè¿˜ä¼šæ±‡æ€»ç›¸å…³çš„å¸¸è§é¢è¯•é¢˜ï¼Œç›®å‰å°šåœ¨æ›´æ–°ä¸­ã€‚

<img src="https://gitee.com/veal98/images/raw/master/img/20210204145531.png" style="zoom:67%;" />

## ğŸ“ è”ç³»æˆ‘

æœ‰ä»€ä¹ˆé—®é¢˜ä¹Ÿå¯ä»¥æ·»åŠ æˆ‘çš„å¾®ä¿¡ï¼Œè®°å¾—å¤‡æ³¨æ¥æ„ï¼šæ ¼å¼ <u>ï¼ˆå­¦æ ¡æˆ–å…¬å¸ - å§“åæˆ–æ˜µç§° - æ¥æ„ï¼‰</u>

<img width="260px" src="https://gitee.com/veal98/images/raw/master/img/å¾®ä¿¡å›¾ç‰‡_20210105121328.jpg" >

## ğŸ‘ é¸£è°¢

æœ¬é¡¹ç›®å‚è€ƒ[ç‰›å®¢ç½‘](https://www.nowcoder.com/) â€” Java é«˜çº§å·¥ç¨‹å¸ˆè¯¾ç¨‹ï¼Œæ„Ÿè°¢è€å¸ˆå’Œå¹³å°